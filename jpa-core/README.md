# JPA Practice
Don't need to set up SpringBoot. \
Understand the way of JPA how to operate.

## Hibernate configuration
Hibernate is implementation of JPA interface. 

You need to set up before entering project.

#### src/main/resources/META-INF/persistence.xml
```xml
<property name="hibernate.hbm2ddl.auto" value="validate" />
```

### hbm2dll.value option

| Value       | Description                                                  | When to use                                                |
|-------------|--------------------------------------------------------------|------------------------------------------------------------|
| create      | ì‹œì‘ì‹œ ìŠ¤í‚¤ë§ˆë¥¼ ì¬ìƒì„±                                                 | ê°œë°œ ì´ˆê¸°ë‹¨ê³„                                                    |
| create-drop | ì–´í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì‹œì ì— ìƒì„±í–ˆë˜ ìŠ¤í‚¤ë§ˆ ì‚­ì œ                                    | í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‹¤í–‰í•˜ê³  ê¹”ë”í•˜ê²Œ ëª¨ë‘ ì‚­ì œí•˜ê³  ì‹¶ì„ ë•Œ                            |
| update      | ì‹œì‘ì‹œ Entity class êµ¬ì„±ê³¼ ìŠ¤í‚¤ë§ˆë¥¼ ë¹„êµí•˜ì—¬ ì»¬ëŸ¼ ì¶”ê°€/ì‚­ì œ , ê¸°ì¡´ ìŠ¤í‚¤ë§ˆë¥¼ ì‚­ì œí•˜ì§€ ì•Šê³  ìœ ì§€ | ê°œë°œ ì´ˆê¸°ë‹¨ê³„ ë˜ëŠ” í…ŒìŠ¤íŠ¸ ì„œë²„ì—ì„œ ë³€ê²½ëœ ìŠ¤í‚¤ë§ˆë§Œ ALTER ë¡œ ë°˜ì˜í•˜ê³  ì‹¶ì„ ë•Œ (ìš´ì˜ì—ëŠ” ì‚¬ìš© X) |
| validate    | ì‹œì‘ì‹œ Entity class êµ¬ì„±ê³¼ ìŠ¤í‚¤ë§ˆê°€ ë‹¤ë¥´ë‹¤ë©´ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚´.                     | Entity class ì •ì˜ì™€ í…Œì´ë¸”ì´ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ”ì§€ë§Œ ë¯¸ë¦¬ í™•ì¸ í•  ë•Œ                 |
| none        | ì‚¬ìš©í•˜ì§€ ì•ŠìŒ                                                      | ê´€ë¡€ìƒ ìœ„ ì˜µì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šì„ ë•Œ ëª…ì‹œ                                     |  

> ğŸ“ staging ë° production ì—ëŠ” `validate`, `none` ì„ ì œì™¸í•˜ê³  ì ˆëŒ€ ì“°ì§€ ë§ˆë¼.
> ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤.
> **ê·¸ëƒ¥ ëª¨ë¥´ê² ìœ¼ë©´ ì•ˆì „í•˜ê²Œ `validate`, `none` ì„ ì¨ë¼.**

### DB DDL Tip 
- DDL ì€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§ì ‘ ì‘ì„±í•´ì„œ í…ŒìŠ¤íŠ¸ DB ì— ë¨¼ì € í…ŒìŠ¤íŠ¸ í•œ í›„ ë°˜ì˜í•˜ë¼. \
ìë™ìœ¼ë¡œ íˆ´ì´ ìƒì„±í•´ì£¼ëŠ” DDL ì—ëŠ” ìœ„í—˜ì´ ì¡´ì¬í•œë‹¤.
- ALTER, DROP ê°™ì€ DDL ì€ ì• ì´ˆì— ê°œë°œìê°€ ì“°ì§€ ëª»í•˜ê²Œ ê³„ì • ë‹¨ìœ„ë¡œ ì ê¶ˆë†“ëŠ”ë‹¤.
- ìµœëŒ€í•œ ë§ì€ ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ Entity class ë‚´ì—ì„œ ì»¬ëŸ¼ ì •ë³´ë¥¼ ì •í™•íˆ ê°œë°œìê°€ ì•Œì•„ë³¼ ìˆ˜ ìˆê²Œ ëª…ì‹œí•˜ë¼. \
ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì§ì ‘ DB DDL ì„ í™•ì¸í•´ì•¼í•´ì„œ ë²ˆê±°ë¡­ë‹¤.

## Entity - Table mapping guide

### Mapping annotations
| Index       | Description                                         |
|-------------|-----------------------------------------------------|
| @Column     | Column                                              |
| @Comment    | Comments on table, column ..                        |
| @Temporal   | Date/Time/Timestamp                                 |
| @Enumerated | enum type                                           |
| @Lob        | BLOB, CLOB                                          |
| Transient   | Not mapping to DB, just use in application instance |

> âœ’ï¸ From java 8, Use `LocalDateTime` instead of `@Temporal` \
Is there any timezone issue?

### Column annotations
| Index            | Description                          |
|------------------|--------------------------------------|
| name             | column name                          |
| nullable         | NULL constraint                      |
| unique           | Unique constraint                    |
| columnDefinition | Input column info using sql syntax   |
| length           | Length of varchar, varchar2, etc..   |
| precision scale  | Use in BigDecimal or BigInteger type |

### Primary Key Mapping
Use `@GeneratedValue`

| Generation Strategy | Description                                             |
|---------------------|---------------------------------------------------------|
| Auto                | Chosen automatically according to DBMS                  |
| IDENTITY            | Generated by default as IDENTITY                        |
| SEQUENCE            | Create and use database sequence object and allocate it |
| TABLE               | Use key generator table (Not recommended)               |

### Tips on Primary Key
You need set the PK meets conditions as shown below.
> 1. Use Long type
> 2. Use Candidate key
> 3. Use Key generation 

### Compare IDENTITY vs SEQUENCE strategy
You can choice **SEQUENCE** when you need JDBC batch insert query \
IDENTITY strategy doesn't support batch optimization since it's required insert query executed to DB for getting generated key.

Refer to [this docs](https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators)

---

## Spring Data JPA
| JPA            | Hibernate                     | Spring DATA JPA            |
|----------------|-------------------------------|----------------------------|
| Just interface | Impelmentation instanceof JPA | Module for easy to use JPA |

### 1. Setting build.gradle
#### build.gradle
```build.gradle
dependencies {
//..
	implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
}
```
### 2. Create interface inheritance of DataJPA
```java
@Repository
public interface UserRepository extends JpaRepository<User, Long> {
}
```
### 3. Test with DI `@DataJpaTest` annotation
```java
// This annotation includes next 2line (@Transactional, @Rollback)
// This disables full auto-configuration and instead apply only configuration relevant to JPA tests.
@DataJpaTest 
@Transactional // Restrict each test code in transaction
@Rollback(value = true)
class UserRepositoryTest {
    @Autowired
    private UserRepository userRepository;
    // ..
}
```
---

# Relationship

![img.png](./src/main/resources/assets/entity_diagram.png)

#### Member.java
```java
@Table(name = "member")
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Getter
public class Member {
    // ..
    @ManyToOne
    @JoinColumn(name = "team_id")
    private Team team;
    // ..
}
```

#### Team.java
```java
@Entity
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class Team {
    // ..
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    @Column(name = "team_id")
    private Long id;
    // ..
}
```

### Entity class
íšŒì› -> íŒ€ ì—°ê´€ê´€ê³„ 1ê°œ \
íŒ€ -> íšŒì› ì—°ê´€ê´€ê³„ 1ê°œ \
ê·¸ë˜ì„œ ì–‘ë°©í–¥ìœ¼ë¡œ ë³´ì´ì§€ë§Œ ì‚¬ì‹¤ìƒ ë‹¨ë°©í–¥ì´ 2ê°œ \
ê°ì²´ë¥¼ ì–‘ë°©í–¥ìœ¼ë¡œ ì°¸ì¡°í•˜ë ¤ë©´ ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ 2ê°œ ë§Œë“¤ì–´ì•¼í•œë‹¤.

### Dilemma
> ë‘˜ ì¤‘ ì–´ëŠ ê°ì²´ì—ì„œ ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í• ì§€ **í•˜ë‚˜ë¥¼ ê²°ì •**í•´ì•¼í•¨. \
> ì´ë•Œ ì„ íƒëœ ì—”í‹°í‹° ê°ì²´ë¥¼ **ì—°ê´€ê´€ê³„ ì£¼ì¸**ì´ë¼ í•¨. \
> **ì—°ê´€ê´€ê³„ ì£¼ì¸ë§Œì´ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬ (ë“±ë¡ & ìˆ˜ì •)** \
> **ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ ì˜¤ë¡œì§€ ì¡°íšŒë§Œ ê°€ëŠ¥.** \
> `@JoinColumn` annotation ì„ ê°€ì§„ ìª½ì´ ì—°ê´€ê´€ê³„ ì£¼ì¸ 

```java
team
    .getMembers()[0]
    .setTeam("~~")
```
**ìˆ˜ì • ì‹œë„ëŠ” Team ì—ì„œ í–ˆì§€ë§Œ , Member ì— ì˜í–¥ì„ ë¯¸ì¹œë‹¤.**

### Table relation
í…Œì´ë¸” ê´€ì ìœ¼ë¡œ ì—°ê´€ê´€ê³„ë¥¼ ë³´ë©´ ê´€ê³„ë¥¼ ê²°ì •í•˜ëŠ” ê²ƒì€ ì™¸ë˜í‚¤ ë‹¨ í•˜ë‚˜ë‹¤. \
team_id ë¥¼ ê°€ì§„ FK ìˆëŠ”ê±° í•˜ë‚˜ë¡œ í…Œì´ë¸” ìƒì—ì„œëŠ” ëª¨ë“  ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

## ğŸ“ Entity class ì„¤ê³„ íŒ
### 1.  ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ë¡œ ì—”í‹°í‹° í´ë˜ìŠ¤ ì„¤ê³„ë¥¼ ëë‚´ë¼.
ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” ê¼­ í•„ìš”í•  ë•Œë§Œ ì‚¬ìš©í•´ì•¼í•œë‹¤.

### 2. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì•„ë‹Œ ì™¸ë˜í‚¤ ìœ„ì¹˜ë¡œ ì—°ê´€ê´€ê³„ ì£¼ì¸ ê²°ì •

#### _ì™¸ë˜í‚¤ë¥¼ ê°€ì§„ ì—”í‹°í‹°ë¥¼ ì—°ê´€ê´€ê³„ ì£¼ì¸ìœ¼ë¡œ ì •í•´ì•¼í•œë‹¤._
1:N ì¼ ë•Œ \
ë¶€ëª¨ 1ì„ `mappedBy` ë¥¼ í†µí•´ ìì‹ì„ ë§µí•‘í•˜ê³  `OneToMany`ìœ¼ë¡œ ì§€ì •í•œë‹¤.\
ìì‹ Nì„ ì—°ê´€ê´€ê³„ ì£¼ì¸ìœ¼ë¡œ ë‘ì–´ `ManyToOne` ìœ¼ë¡œ ì§€ì •í•œë‹¤. \
mappedBy ì— ì˜í•´ ì°¸ì¡°ë˜ëŠ” ë³€ìˆ˜ê°€ Foreign key ë‹¤.


#### _ì™œ ìì‹ì„ ì—°ê´€ê´€ê³„ ì£¼ì¸ìœ¼ë¡œ ë‘ëŠ”ê°€?_
ë¶€ëª¨ì¸ íŒ€ì˜ `members` ë¥¼ ìˆ˜ì •í•˜ì—¬ í…Œì´ë¸” ì—…ë°ì´íŠ¸ë¥¼ í•œë‹¤ê³  ê°€ì •í•˜ë©´ \
ê°ì²´ ìƒì—ì„œ ë³€í™”ë¥¼ ê°€í•œ ìª½ì€ ë¶€ëª¨ ê°ì²´ì¸ë° \
ìì‹ ê°ì²´ì™€ í…Œì´ë¸”ì— Update query ê°€ ì‹¤í–‰ëœë‹¤.

### 3. ê°ì²´ ìƒì—ë„ ëª¨ë‘ ì—°ê´€ê´€ê³„ ë¡œì§ì„ ì ìš©í•œ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œ ì‚¬ìš©
ê°ì²´ìƒì—ì„œë„ ì„œë¡œ ê´€ê³„ë¥¼ ë§ºì–´ì¤˜ì•¼ ì´ìŠˆê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.
```java
/**
 * ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œ
 * @param team
 */
public void changeMemberTeam(Team team) {
    this.team = team;
    team.getMembers().add(this);
}
```

### 4. Lombok ì˜ toString() ì´ë‚˜ JSON ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©ì‹œ ë¬´í•œë£¨í”„ì— ë¹ ì§€ì§€ ì•Šë„ë¡ ìœ ì˜
í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œì§ì„ ë³´ë©´ member -> team -> members -> team -> members ... ë“± ê³„ì† íƒ€ê³  ë“¤ì–´ê°ˆ ìœ„í—˜ì´ ìˆìŒ.

### 5. Controller ì—ì„œ Entity ë¥¼ ê·¸ëŒ€ë¡œ return í•˜ì§€ ì•Šê³  DTO ë¥¼ ì‚¬ìš©í•˜ê¸¸ ê¶Œì¥.
Entity ë¥¼ ê·¸ëŒ€ë¡œ ë¦¬í„´í•œë‹¤ëŠ” ê²ƒì€ Entity ì»¬ëŸ¼ ë³€ê²½ì‹œ API spec ì´ ê°™ì´ ë³€í•  ìˆ˜ ìˆë‹¤.

### 6. @ManyToMany ëŒ€ì‹  ë§µí•‘ í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ê³  PKëŠ” ê³ ìœ ì˜ ê°’ìœ¼ë¡œë§Œ ì§€ì •.
item_id ì™€ order_id ë“±ì„ í•©ì³ ë³µí•©í‚¤ë¥¼ ê¸°ë³¸í‚¤ë¡œ ì§€ì •í•  ìˆ˜ë„ ìˆìœ¼ë‚˜ \
ì •í•©ì„±ì—ë§Œ ì¢‹ì„ ë¿ ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ ìš´ì˜ë©´ì—ì„œëŠ” ìŠ¤í‚¤ë§ˆ ë³€ê²½ì´ ì¢…ì†ì„±ìœ¼ë¡œ ì¸í•´ ë§¤ìš° ì–´ë ¤ì›Œì§€ê¸° ë•Œë¬¸ì— \
ë¹„ì¦ˆë‹ˆìŠ¤ìƒ ì˜ë¯¸ ì—†ë”ë¼ë„ ë³„ë„ì˜ order_item_id ë¥¼ `auto_increment` ë¡œ ê±¸ê¸¸ ì¶”ì²œí•œë‹¤.

![order_item.png](src/main/resources/assets/mapping_table_erd.png)

### 7. MappedSuperclass ì ê·¹ í™œìš©
ë‹¤ìŒ í”„ë¡œí¼í‹°ëŠ” BaseEntity ì— í¬í•¨ì‹œì¼œ ìƒì†ë°›ì•„ ì“°ëŠ”ê²ƒì´ ìš´ì˜ ì¸¡ë©´ì—ì„œ ì¢‹ë‹¤.
- createdBy
- createdTimestamp
- lastModifiedBy
- lastModifiedTimestamp

### 8. ìƒì†ê´€ê³„ ë§¤í•‘ì€ ê¸°ë³¸ì ìœ¼ë¡œ `JOINED` or `SINGLE_TABLE` ì „ëµ ì‚¬ìš©
JOINED ê°€ ê°€ì¥ ì •ê·œí™” ë˜ì–´ìˆê³  ì ì€ ìŠ¤í† ë¦¬ì§€ë¡œ ë†’ì€ ì •í•©ì„±ì„ ë³´ì¥í•˜ë‚˜ í…Œì´ë¸” ê°¯ìˆ˜ì™€ ì¿¼ë¦¬ ë³µì¡ë„ ì¦ê°€ \
í•˜ë£¨ì— ë°ì´í„°ê°€ 100ë§Œê±´ ì´ìƒ ìŒ“ì´ê³  ëˆ„ì  ë ˆì½”ë“œê°€ 1ì–µê±´ ì´ìƒìœ¼ë¡œ Partitioning ë“± ì´ìŠˆê°€ ë§ì•„ì§ˆ ê²½ìš°ì—” \
SINGLE_TABLE ì„ ì‚¬ìš©í•˜ì—¬ ë‹¨ìˆœí•œ í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ êµ¬ì¡°ë¥¼ íƒí•˜ëŠ” ê²ƒì´ ìœ ë¦¬í•  ìˆ˜ ìˆìŒ. \
**ì ˆëŒ€ì ì¸ ì •ë‹µì€ ì—†ë‹¤.**

### 9. ì—”í‹°í‹°ê°€ íŠ¹ì • ì—”í‹°í‹°ì—ë§Œ ì¢…ì†ì ì´ê³  ì™„ì „íˆ ìƒëª…ì£¼ê¸°ë¥¼ ê°™ì´í•  ë•Œ `CASCADE` ì˜µì…˜ ì‚¬ìš©
CASCADE ëŠ” ë¶€ëª¨ ì—”í‹°í‹°ì˜ ì˜ì†ì„± ìƒíƒœë¥¼ ìì‹ ì—”í‹°í‹°ì— ì „ì´ì‹œí‚¨ë‹¤.
![cascade when to use](src/main/resources/assets/cascade_when_to_use.gif)

### 9-1. ê³ ì•„ ê°ì²´ (ë¶€ëª¨ ì—”í‹°í‹°)ë¥¼ ë¶€ëª¨ì™€ í•¨ê»˜ ì‚­ì œì²˜ë¦¬ í•˜ê³ ì‹¶ë‹¤ë©´ `orphanRemoval` ì˜µì…˜ì„ ë¶€ëª¨ìª½ì— ì‚¬ìš©
`CASCADE`ì™€ `orphanRemoval` ì˜µì…˜ì„ ë™ì‹œì— ì‚¬ìš©í•˜ë©´ ì™„ì „íˆ ìƒëª…ì£¼ê¸°ë¥¼ ê°™ì´í•˜ëŠ” ë¡œì§ì„ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.
í…Œì´ë¸” ê´€ì ì—ì„œ ë³´ë©´ `orphanRomoval` ì€ ìì‹ í…Œì´ë¸”ì˜ FKê°€ NULL ìƒíƒœê°€ ë˜ëŠ” ì‹œì ì— ì‚­ì œë¥¼ ê°•ì œí•˜ëŠ” (ON DELETE ì™€ ìœ ì‚¬) ì•¡ì…˜ ì—¬ë¶€ì´ë‹¤.

#### Team.java
```java
public class Team extends BaseEntity {
    // 
    @OneToMany(mappedBy = "team", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<Member> members = new ArrayList<>();
}
```

| í–‰ìœ„ì™€ ì˜µì…˜         | CASCADE.REMOVAL    | orphanRemoval = true |
|----------------|--------------------|----------------------|
| ë¶€ëª¨ ì—”í‹°í‹° ì‚­ì œ      | ìì‹ ì—”í‹°í‹° ì‚­ì œ (ì˜ì†ì„± ì „ì´) | ìì‹ ì—”í‹°í‹° ì‚­ì œ (ê³ ì•„ ìƒíƒœê°€ ë¨) |
| ë¶€ëª¨ì—ì„œ ìì‹ ì—”í‹°í‹° ì‚­ì œ | ë‹¨ë…ìœ¼ë¡œëŠ” ìì‹ ì—”í‹°í‹° ì‚­ì œ X  | ë‹¨ë…ìœ¼ë¡œ ìì‹ ì—”í‹°í‹° ì‚­ì œ O     |


### 10. ì„ë² ë””ë“œ íƒ€ì…ì„ ì ê·¹ í™œìš©í•˜ë¼.
ì˜ ì„¤ê³„í•œ Entity ëŠ” í…Œì´ë¸” ë³´ë‹¤ ê°¯ìˆ˜ê°€ ë§ê³  ì¶”ê°€ í…Œì´ë¸”ì„ ìƒì„± ì—†ì´ ê°ì²´ì™€ í…Œì´ë¸” ë§¤í•‘ì„ ì„¸ë°€í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤. \
ì„ë² ë””ë“œ íƒ€ì…ì— ë©”ì†Œë“œë¥¼ ì •ì˜í•  ìˆ˜ ìˆê³  ì—”í‹°í‹°ì— ìƒëª…ì£¼ê¸°ê°€ ì˜ì¡´ì ì´ë¼ ê°ì²´ ì§€í–¥ì  ì½”ë“œ ì‘ì„±ì´ ìš©ì´í•˜ë‹¤.

### 11. ì„ë² ë””ë“œ íƒ€ì…ì€ ë¬´ì¡°ê±´ ë¶ˆë³€ê°ì²´ë¡œ ë§Œë“¤ì–´ë¼.

- ì˜¤ë¡œì§€ ìƒì„±ìë¡œ í•´ë‹¹ ê°ì²´ë¥¼ ìƒˆë¡œ í• ë‹¹í•˜ëŠ” ë°©ì‹(Immutable)ì„ íƒí•˜ë„ë¡ ê°•ì œí•˜ë¼. \ 
ê³µìœ  ê°ì²´ ì°¸ì¡°ë¥¼ ë§‰ì„ ë°©ë²•ì´ ì—†ê¸° ë•Œë¬¸ì—. ê³µìœ  ê°ì²´ ì°¸ì¡° ìƒí™©ì‹œ ë””ë²„ê¹…ì€ ì •ë§ ì–´ë µë‹¤.
- ê°’ íƒ€ì… (ì„ë² ë””ë“œ íƒ€ì…)ì€ ì‹ë³„ìê°€ ì¡´ì¬í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ”, ë‹¨ìˆœí•œ ë””ìì¸ì´ ê°€ëŠ¥í•œ ê²½ìš°ì— ì‚¬ìš©í•œë‹¤.

> ì‹ë³„ìê°€ í•„ìš”í•˜ê±°ë‚˜ ì§€ì†í•´ì„œ ê°’ì„ ì¶”ì , ë³€ê²½í•´ì•¼ í•œë‹¤ë©´ ì—¬ì§€ì—†ì´ ì—”í‹°í‹°ë¡œ ìŠ¹ê²©ì‹œì¼œë¼.

### 12. ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì€ ë³„ë„ì˜ í…Œì´ë¸”ì„ êµ¬ì„±í•´ì•¼í•œë‹¤.
**DB ëª¨ë¸ë§ ì¸¡ë©´ì—ì„  ê·¹íˆ ìƒì‹ì ì¸ ì´ì•¼ê¸°ë‹¤.** \
í•œ í…Œì´ë¸” ë‚´ì— ë³µìˆ˜ ê°’ì„ ê°–ëŠ” ì»¬ëŸ¼ì„ êµ¬ì„±í•˜ëŠ” ê²ƒì€ ì¢‹ì€ ì„¤ê³„ê°€ ì•„ë‹ˆë‹¤.

**ì•„ì˜ˆ 1:N ë‹¨ë°©í–¥ ê´€ê³„ ë˜ëŠ” ì–‘ë°©í–¥ ê´€ê³„ë¡œ ë¶„ë¦¬í•˜ê³  ë³„ë„ í…Œì´ë¸”ì„ ë§Œë“œëŠ” ê²ƒì´ ì¢‹ë‹¤.** \
ì´ëŠ” ì¼ì¢…ì˜ ì •ê·œí™”ë¡œ íŠ¹ì • ì—”í‹°í‹°ì— ê°™ì€ ë§¥ë½ì„ ê°€ì§€ëŠ” ì»¬ëŸ¼ì´ ë‹¤ìˆ˜ê°€ ë  ë•Œ ì •ê·œí™”ë¥¼ í†µí•´ ë³„ë„ì˜ í…Œì´ë¸”(ì—”í‹°í‹°)ë¥¼ êµ¬ì„±í•˜ëŠ” ê²ƒê³¼ ê°™ë‹¤. \
ì´ë ‡ê²Œ ë§Œë“¤ì–´ì§„ ì—”í‹°í‹°ë¥¼ `Cascade`, `orphanRemoval` ë¡œ ë¼ì´í”„ ì‚¬ì´í´ì„ ë¶€ëª¨ì— ì¢…ì†ì‹œí‚¤ëŠ” ê²ƒì´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‚¬ì´ë“œ ì´í™íŠ¸ë„ ì—†ì• ê³ , DB ëª¨ë¸ë§ ì¸¡ë©´ì—ì„œë„ ê¹”ë”í•œ ì„¤ê³„ë‹¤.

> `ElementCollection`, `CollectionTable` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ë°©ë²•ì´ ì¡´ì¬í•˜ì§€ë§Œ \
> í•´ë‹¹ Embeddable íƒ€ì…ì´ ê°€ì§„ ëª¨ë“  ì»¬ëŸ¼ì„ ë¬¶ì–´ PK ë¡œ ìƒì„±í•´ì•¼í•œë‹¤. \
> ê·¸ëŸ¬ë‚˜ JPA ëŠ” ì•„ì˜ˆ PK ê°€ ì—†ëŠ” í…Œì´ë¸”ì„ ìƒì„±í•´ë²„ë¦°ë‹¤. \
> ì´ë ‡ê²Œë˜ë©´, í•´ë‹¹ Entity class ì—ì„œ ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì— ì—…ë°ì´íŠ¸ë¥¼ ì‹œë„í•  ë•Œ \  
> ëª¨ë“  ì»¬ë ‰ì…˜ì„ ì‹¹ë‹¤ ì§€ìš°ê³  ë³€ê²½ëœ ìƒíƒœë¥¼ í†µì§¸ë¡œ ì €ì¥í•˜ê²Œëœë‹¤.

```java
@Entity
public class Member{
    // ..
    @ElementCollection(fetch = LAZY)
    // ë³„ë„ë¡œ food_table ì´ ìƒì„±ë¨.
    // FK ë¥¼ ê°–ëŠ” ìì‹ í…Œì´ë¸”ë¡œ ìƒì„±ë¨.
    @CollectionTable(
            name = "favorite_food",
            joinColumns = @JoinColumn(name = "member_id")
    )
    @Column(name = "food_name", length = 63)
    private Set<String> favoriteFoods = new HashSet<String>();
}
```
```sql
-- @ElementCollection ê³¼ CollectionTable ì„ í†µí•´ ë§Œë“¤ì–´ì§„ ê°’íƒ€ì… í…Œì´ë¸”, PK ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.
create table FAVORITE_FOOD
(
    MEMBER_ID BIGINT not null,
    FOOD_NAME CHARACTER VARYING(255),
    -- PKê°€ í•„ìš”í•œë°, ì—¬ê¸°ì„œ PK ë¥¼ ë§Œë“œëŠ” ë°©ë²•ì€ ëª¨ë“  ì»¬ëŸ¼ì„ í•¨ê»˜ ë³µí•©í‚¤ë¡œ ë§Œë“œëŠ” ë²• ë¿.
    -- ê·¸ëŸ´ë°”ì—” ë³„ë„ì˜ í…Œì´ë¸”ì„ ìƒì„±í•˜ëŠ”ê²Œ ë‚«ë‹¤.
    constraint FKNJ8USKU5AYU0PGLSUHQOIJHRM
        foreign key (MEMBER_ID) references MEMBER
);
```
